---
title: "EVSI ranking three asset problem"
output: word_document
---

```{r, eval=FALSE, echo=FALSE}
# Cons biol not IMRAD style

## intro, questions, small problem, big problem case studies


# As an alternative to constrained optimisation. Try assigning samples sequentially to the assests. based on which is most uncertain.

# two armed bandit problem

# Operations research texts

# Bayesian experimental design literature

# Two case studies, with heterogenous uncertainty

# buy more than one?

# monitor at all less novel than how monitor with heterogeneity

# starting value of optimizer for N is close to N- 1 etc 

```

##Questions

Should you spend resources on learning when ranking assets for (static) investment with uncertain additive benefits. When is it not benefical to learn at all? If yes, how? 

* How much, if you have one budget? And what if you have two budgets; one for learning and one for investment?
  
* Is the value of learning different if you have to learn about assets homogenously or if you can learn heterogeneously.
  
* If you can allocate learning heterogenously across assets, what is the optimal strategy for a given prior knowledge of the rankings.
  
* If you can choose between heterogenous and homogenous learning and they cost different amounts per unit of information learned, when is it more benficial to do one or the other? (or even a mix strategy?)

* If the problem scope is too large for computing optimal solutions are there heuristics for this problem class.

***

##Hypotheses

* It's always beneficial to learn if the net gain of sampling is positive (cost of learning < EVI), rankings are uncertain and if sampling is continuous.
* More likely to invest in learning if there are two budgets or learning is cheap.
* Heterogenous learning is always more optimal if it costs the same as homogenous learning and there is heterogeneity in the prior knowledge of the rankings.
* It is optimal to first invest in the most uncertain assets when you have few samples available, then as you can afford to sample more you should invest in the assets on the margin, then only invest in all assets if you have a big enough sampling budget, but preferentially to more marginal assets, and then only invest homogenously at another critical sample size.
* These types of problems should have symmetries and a general shape that will help lead to more heuristics. 

***

## Model

###Priors

Let $A$, $B$, $C$ be assets. Each has some value $\theta_a$, $\theta_b$, $\theta_c$ which are uncertain with a joint prior probability distribution,

$$
\begin{bmatrix}\theta^\prime_a \\ \theta^\prime_b \\ \theta^\prime_c\end{bmatrix}\sim\mathcal{N}\left(\begin{bmatrix}\mu^\prime_a \\ \mu^\prime_b \\ \mu^\prime_c\end{bmatrix}, \begin{bmatrix}\tfrac{1}{\tau^\prime_a} & 0 & 0 \\ 0 & \tfrac{1}{\tau^\prime_b} & 0\\ 0 & 0 & \tfrac{1}{\tau^\prime_c} \end{bmatrix}\right)~~~~~~~~~~~~~~~(1)
$$

where $\mu^\prime_a$, $\mu^\prime_b$, and $\mu^\prime_c$ are means and $\tau^\prime_a$, $\tau^\prime_b$ and $\tau^\prime_c$ are the prior precisions. 

###Utilities

We assign utilities to each rank order of $\theta_a$, $\theta_b$ and $\theta_c$ in combination with each action of purchasing one of $A$, $B$ or $C$,

$$ 
\begin{aligned}
u(\theta_a > \theta_b > \theta_c, A)&=1\\
u(\theta_a > \theta_c > \theta_b, A)&=1\\
u(\theta_b > \theta_a > \theta_c, A)&=.5\\
u(\theta_c > \theta_a > \theta_b, A)&=.5~~~~~~~~~~~~~~~(2)\\
u(\theta_b > \theta_c > \theta_a, A)&=0\\
u(\theta_c > \theta_b > \theta_a, A)&=0\\
u(\theta_b > \theta_a > \theta_c, B)&=1\\
\mathrm{etc...}&
\end{aligned}
$$

such that utility is maximised when we purchase the highest ranked asset, zero when we purchase the lowest ranked and somewhere inbetween when we purchase the middle ranked asset.

###Ranking probabilties

We can express the probability of any assets being in a given rank order as the probabililty of two differences being less than zero. Such that, for example,

$$\Pr(\theta^\prime_a > \theta^\prime_b > \theta^\prime_c) = \Pr(\theta^\prime_b-\theta^\prime_a < 0, \theta^\prime_c-\theta^\prime_b < 0)~~~~~~~~~~~~~~~(3)$$

Given this we define two new variables, $Z_1$ and $Z_2$ where 

$$Z^\prime_1 = \theta^\prime_b - \theta^\prime_a~~~~~~~~~~~~~~~(4)$$

and

$$Z^\prime_2 = \theta^\prime_c - \theta^\prime_b~~~~~~~~~~~~~~~(5)$$

Even if $\theta^\prime_a$, $\theta^\prime_b$ and $\theta^\prime_c$ are all uncorrelated $Z_1$ and $Z_2$ will not be, where

$$\mathrm{cov}(Z^\prime_1, Z^\prime_2)=\mathrm{cov}(\theta^\prime_a, \theta^\prime_b) - \mathrm{var}(\theta^\prime_b) - \mathrm{cov}(\theta^\prime_a, \theta^\prime_c) + \mathrm{cov}(\theta^\prime_b, \theta^\prime_c)~~~~~~~~~~~~~~~(6)$$

Which, when $\theta^\prime_a$, $\theta^\prime_b$ and $\theta^\prime_c$ are all uncorrelated simplifies to

$$\mathrm{cov}(Z^\prime_1, Z^\prime_2)=-\mathrm{var}(\theta^\prime_b)~~~~~~~~~~~~~~~(7)$$

Therefore the joint distribution of $Z^\prime_1$ and $Z^\prime_2$ is,

$$
\begin{bmatrix}Z^\prime_1\\Z^\prime_2\end{bmatrix}\sim\mathcal{N}\left(\begin{bmatrix}\mu^\prime_b-\mu^\prime_a\\\mu^\prime_c-\mu^\prime_b\end{bmatrix},\begin{bmatrix}\tfrac{1}{\tau^\prime_a}+\tfrac{1}{\tau^\prime_b}&-\tfrac{1}{\tau^\prime_b}\\-\tfrac{1}{\tau^\prime_b}&\tfrac{1}{\tau^\prime_b}+\tfrac{1}{\tau^\prime_c}\end{bmatrix}\right)~~~~~~~~~~~~~~~(8)
$$

To obtain $\Pr(\theta^\prime_a > \theta^\prime_b > \theta^\prime_c)$ we evalute the multivariate cumulative distribution function of $Z^\prime_1$ and $Z^\prime_2$,

$$
\Phi(Z^\prime_1, Z^\prime_2)~~~~~~~~~~~~~~~(9)
$$

within the limits, $-\infty$ and 0.

###Expected value of perfect information 

To calculate the prior expected utility of purchasing any asset, we weight the utilities for that action (eqn. 2) by the relevant probablities calculated from eqns. 3--9. For instance;

$$
\begin{aligned}
\mathrm{E}^\prime[u(A)]=&\Pr(\theta^\prime_a > \theta^\prime_b > \theta^\prime_c) + 
\Pr(\theta^\prime_a > \theta^\prime_c > \theta^\prime_b) + \\
&.5\times\Pr(\theta^\prime_b > \theta^\prime_a > \theta^\prime_c) +
.5\times\Pr(\theta^\prime_c > \theta^\prime_a > \theta^\prime_b)~~~~~~~~~~~~~~~(10)  
\end{aligned}
$$

The expected value of perfect information then is,

$$
\mathrm{EVPI}=1-\max(\mathrm{E}^\prime[u(A)],\mathrm{E}^\prime[u(B)],\mathrm{E}^\prime[u(C)])~~~~~~~~~~~~~~~(11)
$$

###Updating

Now suppose we can update the priors for $\theta_a$, $\theta_b$ and $\theta_c$ by taking $N$ samples from sampling distrubutions with, for simplicity, some fixed and known variance, $\sigma^2$ and centered on $\theta_a$, $\theta_b$ and $\theta_c$ respectively. Further, we can define $p_a$ and $p_b$ as the proportion of the $N$ samples allocated to sampling for $A$ and $B$ respectively with $1 - p_a - p_b$ being allocated to $C$. We can then use these samples to update the priors for $\theta_a$, $\theta_b$ and $\theta_c$ to obtain preposterior estimates, $\theta^{\prime\prime}_a$, $\theta^{\prime\prime}_b$ and $\theta^{\prime\prime}_c$, where,

$$
\begin{bmatrix}\theta^{\prime\prime}_a \\ \theta^{\prime\prime}_b \\ \theta^{\prime\prime}_c\end{bmatrix}\sim\mathcal{N}\left(\begin{bmatrix}\mu^\prime_a \\ \mu^\prime_b \\ \mu^\prime_c\end{bmatrix}, \begin{bmatrix}\tfrac{1}{\tau^\prime_a+\tfrac{Np_a}{\sigma^2}} & 0 & 0 \\ 0 & \tfrac{1}{\tau^\prime_b+\tfrac{Np_b}{\sigma^2}} & 0\\ 0 & 0 & \tfrac{1}{\tau^\prime_c+\tfrac{N-Np_a-Np_b}{\sigma^2}} \end{bmatrix}\right)~~~~~~~~~~~~~~~(12)
$$

###Expected value of sample information

For any given new rank order, based on the updated preposterior distributions, we can again calculate a probablity by defining new variables (i.e., $Z^{\prime\prime}_1$ and $Z^{\prime\prime}_2$) and evalute their multivariate cumulative distribution as in eqns. 3--9. Therefore we can obtain the preposterior expected utilities for each purchase action by weighting the preposterior probablites by their respective utilities as in eqn. 10. Accordingly the expected vale of sample information is

$$
\mathrm{EVSI}=\max(\mathrm{E}^{\prime\prime}[u(A)],\mathrm{E}^{\prime\prime}[u(B)],\mathrm{E}^{\prime\prime}[u(C)])-\max(\mathrm{E}^\prime[u(A)],\mathrm{E}^\prime[u(B)],\mathrm{E}^\prime[u(C)])~~~~(13)
$$

###Optimisation

Using eqns 8-13 we can find the optimal values of $p_a$ and $p_b$ for any given $n$ that will maximise the EVSI. Below we examine a number of case studies for different sets of prior distrbutions for $\theta_a$, $\theta_b$, $\theta_c$.

```{r, echo=FALSE, message=FALSE}
calc_jp <- function(mu_a, mu_b, mu_c, tau_a, tau_b, tau_c) {
  require(mvtnorm)
  pr_ord <- function(ord) {
  
  mu_ <- unname(unlist(mget(paste('mu', ord, sep='_'), inherits=TRUE)))
  var_ <- 1 / unname(unlist(mget(paste('tau', ord, sep='_'), inherits=TRUE)))
  
  muz <- c(mu_[2] - mu_[1], mu_[3] - mu_[2])
  varz <- c(var_[1] + var_[2], var_[2] + var_[3])
    
  pmvnorm(c(-Inf, -Inf), c(0, 0), 
    mean=muz, 
    sigma=rbind(c(varz[1], -var_[2]), c(-var_[2], varz[2])))
  }
  
  return(
    c(pr_ord(c('a', 'b', 'c')), 
      pr_ord(c('a', 'c', 'b')), 
      pr_ord(c('b', 'a', 'c')), 
      pr_ord(c('b', 'c', 'a')), 
      pr_ord(c('c', 'a', 'b')), 
      pr_ord(c('c', 'b', 'a'))
    )
  )
}

upd_tau <- function(sigma2, n, tau) {
  tau + (n / sigma2) 
}

EVPI <- function(mu_a, mu_b, mu_c, tau_a, tau_b, tau_c) {
  
  jps <- calc_jp(mu_a, mu_b, mu_c, tau_a, tau_b, tau_c)
  
  E_pri_uA <- sum(jps * c(1, 1, .5, 0, .5, 0))
  E_pri_uB <- sum(jps * c(.5, 0, 1, 1, 0, .5))
  E_pri_uC <- sum(jps * c(0, .5, 0, .5, 1, 1))
  
  1 - pmax(E_pri_uA, E_pri_uB, E_pri_uC)

}

EVSI <- function(mu_a, mu_b, mu_c, tau_a, tau_b, tau_c, sigma2, N, p) {
  sapply(N, 
    function(N) {
      jps <- calc_jp(mu_a, mu_b, mu_c, tau_a, tau_b, tau_c)
    
      E_pri_uA <- sum(jps * c(1, 1, .5, 0, .5, 0))
      E_pri_uB <- sum(jps * c(.5, 0, 1, 1, 0, .5))
      E_pri_uC <- sum(jps * c(0, .5, 0, .5, 1, 1))
      
      tau_a <- upd_tau(sigma2, N * p[1], tau_a)
      tau_b <- upd_tau(sigma2, N * p[2], tau_b)
      tau_c <- upd_tau(sigma2, N * (1 - p[1] - p[2]), tau_c)
      
      jps <- calc_jp(mu_a, mu_b, mu_c, tau_a, tau_b, tau_c)
    
      E_post_uA <- sum(jps * c(1, 1, .5, 0, .5, 0))
      E_post_uB <- sum(jps * c(.5, 0, 1, 1, 0, .5))
      E_post_uC <- sum(jps * c(0, .5, 0, .5, 1, 1))
      
      pmax(E_post_uA, E_post_uB, E_post_uC) - 
        pmax(E_pri_uA, E_pri_uB, E_pri_uC)
    }
  )  
}

EVSI_opt <- function(mu_a, mu_b, mu_c, tau_a, tau_b, tau_c, sigma2, N) {
   require(parallel)
  simplify2array(mclapply(N, 
     function(N) {   
       sol <- constrOptim(c(1/3, 1/3),
         function(p) {
           EVSI(mu_a, mu_b, mu_c, tau_a, tau_b, tau_c, sigma2, N, p)
        }, NULL, rbind(c(1, 0), c(0, 1), c(-1, -1)), c(0, 0, -1),
        control=list(fnscale=-1)        
       )
       return(c(sol$value, sol$par[1], sol$par[2], 1 - sol$par[1] - sol$par[2]))
     }, mc.cores=detectCores()
   ))
} 

plot_EVSI_rank <- function(mu_a, mu_b, mu_c, tau_a, tau_b, tau_c, sigma2, N, sql) {
  p <- c(1/3, 1/3)
  EVPI_ <<- EVPI(mu_a=mu_a, mu_b=mu_b, mu_c=mu_c, tau_a=tau_a, tau_b=tau_b, tau_c=tau_c)
  EVSI_ <<- EVSI(mu_a=mu_a, mu_b=mu_b, mu_c=mu_c, tau_a=tau_a, tau_b=tau_b, tau_c=tau_c,
    sigma2=sigma2, N=seq(3, N, len=sql), p=p)
  EVSI_opt_ <<- t(EVSI_opt(mu_a=mu_a, mu_b=mu_b, mu_c=mu_c, tau_a=tau_a, tau_b=tau_b, 
    tau_c=tau_c, sigma2=sigma2, N=seq(3, N, len=sql)))
  
  par(mfcol=c(2, 2), mar=c(1, 1, 0, 0), oma=c(4, 3.5, 1, 5))
  
  plot.new()  
  plot.window(xlim=c(0, N), ylim=c(0, 1.05))
  box()
  axis(2, las=1)
  mtext('p', side=2, line=3, las=1, font=3)
  abline(h=1/3, lwd=2, col='grey', lty=2)
  points(seq(3, N, len=sql), EVSI_opt_[, 2], type='l', lwd=2, lty=2)
  points(seq(3, N, len=sql), EVSI_opt_[, 3], type='l', lwd=2, col='red', lty=3)
  points(seq(3, N, len=sql), EVSI_opt_[, 4], type='l', lwd=2, col='blue', lty=4)
  mtext('a ', side=3, line=-1.3, adj=1)
  
  plot.new()  
  plot.window(xlim=c(0, N), ylim=c(0, .57))
  box()
  axis(1)
  axis(2, las=1)
  mtext('N', side=1, line=2.5, font=3)
  mtext('--- p=optimum', adj=0, side=1, line=3.5, col='red')
  mtext(sprintf('--- p=%s', round(p, digits=2)), adj=1, side=1, line=3.5, col='black')
  mtext('EVSI', side=2, line=3)
  abline(h=EVPI_, lwd=2)
  points(seq(3, N, len=sql), EVSI_, type='l', lwd=2, lty=3)
  points(seq(3, N, len=sql), EVSI_opt_[, 1], type='l', lty=2, col='red')
  text(0, EVPI_, sprintf('                         EVPI = %s', round(EVPI_, 3)), pos=3)
  mtext('c ', side=3, line=-1.3, adj=1)
   
  plot.new()  
  plot.window(xlim=c(0, 6), ylim=c(
    min(mu_a - 2.5 * (tau_a^-.5), mu_b - 2.5 * (tau_b^-.5), mu_c - 2.5 * (tau_c^-.5)), 
    max(mu_a + 2.5 * (tau_a^-.5), mu_b + 2.5 * (tau_b^-.5), mu_c + 2.5 * (tau_c^-.5))))
  box()
  axis(4, las=1)
  segments(c(1.5, 3.5, 5.5), c(mu_a - 1.96 * (tau_a^-.5), mu_b - 1.96 * (tau_b^-.5), mu_c - 1.96 * (tau_c^-.5)), 
    y1=c(mu_a + 1.96 * (tau_a^-.5), mu_b + 1.96 * (tau_b^-.5), mu_c + 1.96 * (tau_c^-.5)), , col=c('black', 'red', 'blue'))
  points(c(1.5, 3.5, 5.5), c(mu_a, mu_b, mu_c), pch=19, col=c('black', 'red', 'blue'))
  text(1.5, mu_a, bquote({mu*"'"}[a]==.(round(mu_a, 3))), pos=2, font=3, col='black')
  text(3.5, mu_b, bquote({mu*"'"}[b]==.(round(mu_b, 3))), pos=2, font=3, col='red')
  text(5.5, mu_c, bquote({mu*"'"}[c]==.(round(mu_c, 3))), pos=2, font=3, col='blue')
  text(.5, min(mu_a - 2.5 * (tau_a^-.5), mu_b - 2.5 * (tau_b^-.5), mu_c - 2.5 * (tau_c^-.5)) / 2, 
    bquote(sigma == .(round(sqrt(sigma2), 1))))
  mtext('b ', side=3, line=-1.3, adj=1)
   
  plot.new()  
  plot.window(xlim=c(0, N), ylim=c(0, max(EVSI_opt_[, 1] - EVSI_, .001) * 1.2))
  box()
  axis(1)
  axis(4, las=1)
  mtext('N', side=1, line=2.5, font=3)
  mtext(bquote('EVSI'^'p=optimum' - 'EVSI'^.(paste('p =', round(p, digits=2)))), side=4, line=4)
  optN <<- seq(3, N, len=sql)[which.max(EVSI_opt_[, 1] - EVSI_)]
  if (var(EVSI_opt_[, 1]  - EVSI_) == 0) optN <<- 0
  abline(v=optN, col='red')
  text(optN,
    max(EVSI_opt_[, 1] - EVSI_, .001) * 1.18, 
    round(optN), col='red', pos=4)
  abline(h=max(EVSI_opt_[, 1] - EVSI_), col='blue', lty=4)
  text(0, max(EVSI_opt_[, 1] - EVSI_),  
    bquote('                                                   EVSI'^
    'p=optimum' - 'EVSI'^.(paste('p =', round(p, digits=2))) == 
      .(round(max(EVSI_opt_[, 1] - EVSI_), 3))),
    pos=3, col='blue')
  points(seq(3, N, len=sql), EVSI_opt_[, 1] - EVSI_, type='l', lwd=3) 
  mtext('d ', side=3, line=-1.3, adj=1)
  
}
```

***

##Summary

* It is always beneficial to allocate sampling in unequal proportions, unless, (a) the prior means are homogenous (case study 1), (b) $N$ is large and the prior means at the margin are homogenous (case study 2a) or $N$ is very large such that EVSI approaches EVPI. 
* Principle 1: When the budget ($N$) for monitoring is small monitor only those assets at the margin. 
* Principle 2: As $N$ gets larger start to monitor the most uncertain assets next.
* Principle 3: For very large $N$ monitor all assets equally.
* Caveat: Principles 1 and 2 can interact. (i.e., when the most marginal assets are also the most uncertain or when an asset is so uncertain it becomes marginal)

* In contrast to the two asset problem, the optimal allocation is sensitive the variation in prior means.
* Like the two asset problem the optimal allocation is sensitive to the variation in the prior precisions.

***

##Case studies

####Case study 1: homogenous prior precisions and homogenous prior means.  
####  

```{r x000_1_1_1, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=0, mu_b=0, mu_c=0, tau_a=.1, tau_b=.1, tau_c=.1, sigma2=225, N=50000, sql=25)
```
  
There is no optimal solution in this case. Theoretically can't do any learning about ranking probabiliites when $\theta^\prime_a = \theta^\prime_b = \theta^\prime_c$. So best strategy is allocate in equal proportions. This remains the same under circumstances where there is homogenous prior means.

***

####Case study 2a: homogenous prior precisions and heterogenous prior means
####$\mu^\prime_a = \mu^\prime_b > \mu^\prime_c$.
####  

```{r x110_1_1_1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=1, mu_c=0, tau_a=.1, tau_b=.1, tau_c=.1, sigma2=225, N=50, sql=100)
```

```{r x110_1_1_1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=1, mu_c=0, tau_a=.1, tau_b=.1, tau_c=.1, sigma2=225, N=5000, sql=100)
```

```{r x110_1_1_1c, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=1, mu_c=0, tau_a=.1, tau_b=.1, tau_c=.1, sigma2=225, N=50000, sql=100)
```

####Case study 2b: homogenous prior precisions and heterogenous prior means
####$\mu^\prime_a > \mu^\prime_b = \mu^\prime_c$
####  

```{r x100_1_1_1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=0, tau_a=.1, tau_b=.1, tau_c=.1, sigma2=225, N=50, sql=100)
```

```{r x100_1_1_1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=0, tau_a=.1, tau_b=.1, tau_c=.1, sigma2=225, N=50000, sql=100)
```

####Case study 2c: homogenous prior precisions and heterogenous prior means
####$\mu^\prime_a > \mu^\prime_b > \mu^\prime_c$
####  

```{r x10n1_1_1_1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.1, tau_b=.1, tau_c=.1, sigma2=225, N=50, sql=100)
```

```{r x10n1_1_1_1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.1, tau_b=.1, tau_c=.1, sigma2=225, N=5000, sql=100)
```

```{r x10n1_1_1_1c, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.1, tau_b=.1, tau_c=.1, sigma2=225, N=50000, sql=100)
```

***

####Case study 3a: heterogenous prior precisions and heterogenous prior means
####$\mu^\prime_a > \mu^\prime_b = \mu^\prime_c$
####$\tau^\prime_a < \tau^\prime_b = \tau^\prime_c$
####  

```{r x100___1_1_1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=0, tau_a=.001, tau_b=.1, tau_c=.1, sigma2=225, N=50, sql=100)
```

```{r x100___1_1_1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=0, tau_a=.001, tau_b=.1, tau_c=.1, sigma2=225, N=5000, sql=100)
```

```{r x100___1_1_1c, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=0, tau_a=.001, tau_b=.1, tau_c=.1, sigma2=225, N=50000, sql=100)
```

####Case study 3b: heterogenous prior precisions and heterogenous prior means
####$\mu^\prime_a > \mu^\prime_b = \mu^\prime_c$
####$\tau^\prime_a > \tau^\prime_b = \tau^\prime_c$
####  

```{r x1001_1_1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=0, tau_a=.1, tau_b=.001, tau_c=.001, sigma2=225, N=50, sql=100)
```

```{r x1001_1_1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=0, tau_a=.1, tau_b=.001, tau_c=.001, sigma2=225, N=5000, sql=100)
```

```{r x1001_1_1c, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=0, tau_a=.1, tau_b=.001, tau_c=.001, sigma2=225, N=50000, sql=100)
```

####Case study 3c: heterogenous prior precisions and heterogenous prior means
####$\mu^\prime_a = \mu^\prime_b > \mu^\prime_c$
####$\tau^\prime_a = \tau^\prime_b > \tau^\prime_c$
####  

```{r x110__1__1_1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=1, mu_c=0, tau_a=.001, tau_b=.001, tau_c=.1, sigma2=225, N=50, sql=100)
```

```{r x110__1__1_1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=1, mu_c=0, tau_a=.001, tau_b=.001, tau_c=.1, sigma2=225, N=5000, sql=100)
```

```{r x110__1__1_1c, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=1, mu_c=0, tau_a=.001, tau_b=.001, tau_c=.1, sigma2=225, N=50000, sql=100)
```

####Case study 3d: heterogenous prior precisions and heterogenous prior means
####$\mu^\prime_a > \mu^\prime_b = \mu^\prime_c$
####$\tau^\prime_a = \tau^\prime_b > \tau^\prime_c$
####  

```{r x100__1__1_1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=0, tau_a=.001, tau_b=.001, tau_c=.1, sigma2=225, N=50, sql=100)
```

```{r x100__1__1_1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=0, tau_a=.001, tau_b=.001, tau_c=.1, sigma2=225, N=5000, sql=100)
```

```{r x100__1__1_1c, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=0, tau_a=.001, tau_b=.001, tau_c=.1, sigma2=225, N=50000, sql=100)
```

####Case study 3e: heterogenous prior precisions and heterogenous prior means
####$\mu^\prime_a > \mu^\prime_b = \mu^\prime_c$
####$\tau^\prime_a = \tau^\prime_b < \tau^\prime_c$
####  

```{r x100_1_1__1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=0, tau_a=.1, tau_b=.1, tau_c=.001, sigma2=225, N=50, sql=100)
```

```{r x100_1_1__1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=0, tau_a=.1, tau_b=.1, tau_c=.001, sigma2=225, N=5000, sql=100)
```

```{r x100_1_1__1c, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=0, tau_a=.1, tau_b=.1, tau_c=.001, sigma2=225, N=50000, sql=100)
```

####Case study 3f: heterogenous prior precisions and heterogenous prior means
####$\mu^\prime_a = \mu^\prime_b > \mu^\prime_c$
####$\tau^\prime_a = \tau^\prime_c > \tau^\prime_b$
####  

```{r x110__1_1__1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=1, mu_c=0, tau_a=.001, tau_b=.1, tau_c=.001, sigma2=225, N=50, sql=100)
```

```{r x110__1_1__1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=1, mu_c=0, tau_a=.001, tau_b=.1, tau_c=.001, sigma2=225, N=5000, sql=100)
```

```{r x110__1_1__1c, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=1, mu_c=0, tau_a=.001, tau_b=.1, tau_c=.001, sigma2=225, N=50000, sql=100)
```

####Case study 3g: heterogenous prior precisions and heterogenous prior means
####$\mu^\prime_a = \mu^\prime_b > \mu^\prime_c$
####$\tau^\prime_a = \tau^\prime_c < \tau^\prime_b$
####  

```{r x110_1__1_1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=1, mu_c=0, tau_a=.1, tau_b=.001, tau_c=.1, sigma2=225, N=50, sql=100)
```

```{r x110_1__1_1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=1, mu_c=0, tau_a=.1, tau_b=.001, tau_c=.1, sigma2=225, N=5000, sql=100)
```

```{r x110_1__1_1c, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=1, mu_c=0, tau_a=.1, tau_b=.001, tau_c=.1, sigma2=225, N=50000, sql=100)
```

####Case study 3h: heterogenous prior precisions and heterogenous prior means
####$\mu^\prime_a > \mu^\prime_b = \mu^\prime_c$
####$\tau^\prime_a > \tau^\prime_b > \tau^\prime_c$
####  

```{r x100_1__1___1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=0, tau_a=.1, tau_b=.01, tau_c=.001, sigma2=225, N=50, sql=100)
```

```{r x100_1__1___1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=0, tau_a=.1, tau_b=.01, tau_c=.001, sigma2=225, N=5000, sql=100)
```

```{r x100_1__1___1c, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=0, tau_a=.1, tau_b=.01, tau_c=.001, sigma2=225, N=50000, sql=100)
```

####Case study 3i: heterogenous prior precisions and heterogenous prior means
####$\mu^\prime_a > \mu^\prime_b = \mu^\prime_c$
####$\tau^\prime_b > \tau^\prime_a > \tau^\prime_c$
####  


```{r x100__1_1___1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=0, tau_a=.01, tau_b=.1, tau_c=.001, sigma2=225, N=50, sql=100)
```

```{r x100__1_1___1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=0, tau_a=.01, tau_b=.1, tau_c=.001, sigma2=225, N=5000, sql=100)
```

```{r x100__1_1___1c, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=0, tau_a=.01, tau_b=.1, tau_c=.001, sigma2=225, N=50000, sql=100)
```

####Case study 3j: heterogenous prior precisions and heterogenous prior means
####$\mu^\prime_a > \mu^\prime_b = \mu^\prime_c$
####$\tau^\prime_a < \tau^\prime_b < \tau^\prime_c$
####  

```{r x100___1__1_1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=0, tau_a=.001, tau_b=.01, tau_c=.1, sigma2=225, N=50, sql=100)
```

```{r x100___1__1_1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=0, tau_a=.001, tau_b=.01, tau_c=.1, sigma2=225, N=5000, sql=100)
```

```{r x100___1__1_1c, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=0, tau_a=.001, tau_b=.01, tau_c=.1, sigma2=225, N=50000, sql=100)
```

####Case study 3k: heterogenous prior precisions and heterogenous prior means
####$\mu^\prime_a = \mu^\prime_b > \mu^\prime_c$
####$\tau^\prime_a > \tau^\prime_b > \tau^\prime_c$
####  

```{r x110_1__1___1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=1, mu_c=0, tau_a=.1, tau_b=.01, tau_c=.001, sigma2=225, N=50, sql=100)
```

```{r x110_1__1___1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=1, mu_c=0, tau_a=.1, tau_b=.01, tau_c=.001, sigma2=225, N=5000, sql=100)
```

```{r x110_1__1___1c, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=1, mu_c=0, tau_a=.1, tau_b=.01, tau_c=.001, sigma2=225, N=50000, sql=100)
```

####Case study 3l: heterogenous prior precisions and heterogenous prior means
####$\mu^\prime_a = \mu^\prime_b > \mu^\prime_c$
####$\tau^\prime_a > \tau^\prime_c > \tau^\prime_b$
####  


```{r x110_1___1__1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=1, mu_c=0, tau_a=.1, tau_b=.001, tau_c=.01, sigma2=225, N=50, sql=100)
```

```{r x110_1___1__1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=1, mu_c=0, tau_a=.1, tau_b=.001, tau_c=.01, sigma2=225, N=5000, sql=100)
```

```{r x110_1___1__1c, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=1, mu_c=0, tau_a=.1, tau_b=.001, tau_c=.01, sigma2=225, N=50000, sql=100)
```

####Case study 3m: heterogenous prior precisions and heterogenous prior means
####$\mu^\prime_a = \mu^\prime_b > \mu^\prime_c$
####$\tau^\prime_a < \tau^\prime_b < \tau^\prime_c$
####  


```{r x110___1__1_1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=1, mu_c=0, tau_a=.001, tau_b=.01, tau_c=.1, sigma2=225, N=50, sql=100)
```

```{r x110___1__1_1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=1, mu_c=0, tau_a=.001, tau_b=.01, tau_c=.1, sigma2=225, N=5000, sql=100)
```

```{r x110___1__1_1c, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=1, mu_c=0, tau_a=.001, tau_b=.01, tau_c=.1, sigma2=225, N=50000, sql=100)
```

####Case study 3n: heterogenous prior precisions and heterogenous prior means
####$\mu^\prime_a > \mu^\prime_b > \mu^\prime_c$
####$\tau^\prime_a > \tau^\prime_b = \tau^\prime_c$
####  

```{r x10n1_1__1__1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.1, tau_b=.001, tau_c=.001, sigma2=225, N=50, sql=100)
```

```{r x10n1_1__1__1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.1, tau_b=.001, tau_c=.001, sigma2=225, N=5000, sql=100)
```

```{r x10n1_1__1__1c, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.1, tau_b=.001, tau_c=.001, sigma2=225, N=50000, sql=100)
```

####Case study 3o: heterogenous prior precisions and heterogenous prior means
####$\mu^\prime_a > \mu^\prime_b > \mu^\prime_c$
####$\tau^\prime_a = \tau^\prime_b > \tau^\prime_c$
####  

```{r x10n1__1__1_1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.001, tau_b=.001, tau_c=.1, sigma2=225, N=50, sql=100)
```

```{r x10n1__1__1_1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.001, tau_b=.001, tau_c=.1, sigma2=225, N=5000, sql=100)
```

```{r x10n1__1__1_1c, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.001, tau_b=.001, tau_c=.1, sigma2=225, N=50000, sql=100)
```

####Case study 3p: heterogenous prior precisions and heterogenous prior means
####$\mu^\prime_a > \mu^\prime_b > \mu^\prime_c$
####$\tau^\prime_a = \tau^\prime_c < \tau^\prime_b$
####  

```{r x10n1__1_1__1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.001, tau_b=.1, tau_c=.001, sigma2=225, N=50, sql=100)
```

```{r x10n1__1_1__1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.001, tau_b=.1, tau_c=.001, sigma2=225, N=5000, sql=100)
```

```{r x10n1__1_1__1c, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.001, tau_b=.1, tau_c=.001, sigma2=225, N=50000, sql=100)
```

####Case study 3q: heterogenous prior precisions and heterogenous prior means
####$\mu^\prime_a > \mu^\prime_b > \mu^\prime_c$
####$\tau^\prime_a = \tau^\prime_b > \tau^\prime_c$
####  

```{r x10n1_1_1__1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.1, tau_b=.1, tau_c=.001, sigma2=225, N=50, sql=100)
```

```{r x10n1_1_1__1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.1, tau_b=.1, tau_c=.001, sigma2=225, N=5000, sql=100)
```

```{r x10n1_1_1__1c, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.1, tau_b=.1, tau_c=.001, sigma2=225, N=50000, sql=100)
```

####Case study 3r: heterogenous prior precisions and heterogenous prior means
####$\mu^\prime_a > \mu^\prime_b > \mu^\prime_c$
####$\tau^\prime_a < \tau^\prime_b = \tau^\prime_c$
####  

```{r x10n1__1_1_1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.001, tau_b=.1, tau_c=.1, sigma2=225, N=50, sql=100)
```

```{r x10n1__1_1_1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.001, tau_b=.1, tau_c=.1, sigma2=225, N=5000, sql=100)
```

```{r x10n1__1_1_1c, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.001, tau_b=.1, tau_c=.1, sigma2=225, N=50000, sql=100)
```

####Case study 3s: heterogenous prior precisions and heterogenous prior means
####$\mu^\prime_a > \mu^\prime_b > \mu^\prime_c$
####$\tau^\prime_a = \tau^\prime_c > \tau^\prime_b$
####  

```{r x10n1_1__1_1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.1, tau_b=.001, tau_c=.1, sigma2=225, N=50, sql=100)
```

```{r x10n1_1__1_1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.1, tau_b=.001, tau_c=.1, sigma2=225, N=5000, sql=100)
```

```{r x10n1_1__1_1c, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.1, tau_b=.001, tau_c=.1, sigma2=225, N=50000, sql=100)
```

####Case study 3t: heterogenous prior precisions and heterogenous prior means
####$\mu^\prime_a > \mu^\prime_b > \mu^\prime_c$
####$\tau^\prime_a > \tau^\prime_b > \tau^\prime_c$
####  

```{r x10n1_1__1___1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.1, tau_b=.01, tau_c=.001, sigma2=225, N=50, sql=100)
```

```{r x10n1_1__1___1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.1, tau_b=.01, tau_c=.001, sigma2=225, N=5000, sql=100)
```

```{r x10n1_1__1___1c, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.1, tau_b=.01, tau_c=.001, sigma2=225, N=50000, sql=100)
```

####Case study 3u: heterogenous prior precisions and heterogenous prior means
####$\mu^\prime_a > \mu^\prime_b > \mu^\prime_c$
####$\tau^\prime_b > \tau^\prime_a > \tau^\prime_c$
####  

```{r x10n1__1_1___1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.01, tau_b=.1, tau_c=.001, sigma2=225, N=50, sql=100)
```

```{r x10n1__1_1___1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.01, tau_b=.1, tau_c=.001, sigma2=225, N=5000, sql=100)
```

```{r x10n1__1_1___1c, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.01, tau_b=.1, tau_c=.001, sigma2=225, N=50000, sql=100)
```

####Case study 3v: heterogenous prior precisions and heterogenous prior means
####$\mu^\prime_a > \mu^\prime_b > \mu^\prime_c$
####$\tau^\prime_a > \tau^\prime_c > \tau^\prime_b$
####  

```{r x10n1_1___1__1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.1, tau_b=.001, tau_c=.01, sigma2=225, N=50, sql=100)
```

```{r x10n1_1___1__1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.1, tau_b=.001, tau_c=.01, sigma2=225, N=5000, sql=100)
```

```{r x10n1_1___1__1c, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.1, tau_b=.001, tau_c=.01, sigma2=225, N=50000, sql=100)
```

####Case study 3x: heterogenous prior precisions and heterogenous prior means
####$\mu^\prime_a > \mu^\prime_b > \mu^\prime_c$
####$\tau^\prime_a < \tau^\prime_c < \tau^\prime_b$
####  

```{r x10n1__1___1_1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.01, tau_b=.001, tau_c=.1, sigma2=225, N=50, sql=100)
```

```{r x10n1__1___1_1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.01, tau_b=.001, tau_c=.1, sigma2=225, N=5000, sql=100)
```

```{r x10n1__1___1_1c, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.01, tau_b=.001, tau_c=.1, sigma2=225, N=50000, sql=100)
```

####Case study 3y: heterogenous prior precisions and heterogenous prior means
####$\mu^\prime_a > \mu^\prime_b > \mu^\prime_c$
####$\tau^\prime_a < \tau^\prime_b < \tau^\prime_c$
####  

```{r x10n1___1__1_1a, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.001, tau_b=.01, tau_c=.1, sigma2=225, N=50, sql=100)
```

```{r x10n1___1__1_1b, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.001, tau_b=.01, tau_c=.1, sigma2=225, N=5000, sql=100)
```

```{r x10n1___1__1_1c, echo=FALSE, cache=TRUE, message=FALSE}
plot_EVSI_rank(mu_a=1, mu_b=0, mu_c=-1, tau_a=.001, tau_b=.01, tau_c=.1, sigma2=225, N=50000, sql=100)
```
