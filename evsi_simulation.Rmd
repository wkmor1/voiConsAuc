---
output: html_document
---

#### 1. EVSI for two uncorrelated i.i.d normal distributions with mean 0 and standard deviation 1

When the standard deviation of the sampling distribution is 1 then the EVSI as a
function of $x$ (the number of samples each distribution is updated by) is

$\frac{1}{2}\sqrt{\frac{4x}{\pi(x + 1)}}$

```{r}
evsi = function(x) .5 * sqrt(4 * x / (pi * (x + 1)))
```

#### 2. Simulation with a Bayesian preposterior analysis

A = matrix(rnorm(2000), 2)

rnorm(rep(1, 2), A[, 2])


Let $\theta$ be the mean of sample from the prior x

```{r}
posterior = function(theta, x, nps) {
    rnorm(nps, theta * x / (x + 1), sqrt(1 / (x + 1)))
}
```

```{r}
evsi_sim =
  function(x = c(1, 1), npd = 10000, nps = 10000) {
    arr =
      array(
        sapply(
          x,
          function(n) {
            theta = rnorm(npd)
            ans = lapply(theta, posterior, x = x, nps = nps)
            do.call(cbind, ans)
          }
        ),
        dim = c(nps, npd, length(n))
      )
    mean(apply(apply(arr, 2:3, mean), 1, max))
  }
```

```{r, eval = FALSE}
no_of_samples = c(1, 2, 3, 5, 10,  25, 50, 100, 200, 400, 700)
evsi_sim_results = sapply(x, evsi_sim)
```

```{r, eval = FALSE}
plot(no_of_samples, evsi_sim_results, log = "x")
curve(evsi, from = 1, to = 700, add = TRUE)
```